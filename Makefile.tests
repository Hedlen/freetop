# æµ‹è¯•ç›¸å…³çš„Makefile
# æä¾›ä¾¿æ·çš„æµ‹è¯•æ‰§è¡Œå‘½ä»¤

.PHONY: test test-unit test-integration test-functional test-e2e test-coverage test-html install-test-deps clean-test

# é»˜è®¤æµ‹è¯•å‘½ä»¤
test:
	@echo "ğŸ§ª è¿è¡Œæ‰€æœ‰æµ‹è¯•..."
	@python run_tests.py --type all

# å•å…ƒæµ‹è¯•
test-unit:
	@echo "ğŸ”¬ è¿è¡Œå•å…ƒæµ‹è¯•..."
	@python run_tests.py --type unit

# é›†æˆæµ‹è¯•
test-integration:
	@echo "ğŸ”— è¿è¡Œé›†æˆæµ‹è¯•..."
	@python run_tests.py --type integration

# åŠŸèƒ½æµ‹è¯•
test-functional:
	@echo "âš™ï¸ è¿è¡ŒåŠŸèƒ½æµ‹è¯•..."
	@python run_tests.py --type functional

# ç«¯åˆ°ç«¯æµ‹è¯•
test-e2e:
	@echo "ğŸŒ è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•..."
	@python run_tests.py --type e2e

# å¿«é€Ÿæµ‹è¯•ï¼ˆè·³è¿‡æ…¢é€Ÿæµ‹è¯•ï¼‰
test-fast:
	@echo "âš¡ è¿è¡Œå¿«é€Ÿæµ‹è¯•..."
	@python run_tests.py --markers "not slow"

# æµè§ˆå™¨ç›¸å…³æµ‹è¯•
test-browser:
	@echo "ğŸŒ è¿è¡Œæµè§ˆå™¨ç›¸å…³æµ‹è¯•..."
	@python run_tests.py --markers "browser"

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
test-coverage:
	@echo "ğŸ“Š è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š..."
	@python run_tests.py --coverage

# ç”ŸæˆHTMLè¦†ç›–ç‡æŠ¥å‘Š
test-html:
	@echo "ğŸ“Š ç”ŸæˆHTMLè¦†ç›–ç‡æŠ¥å‘Š..."
	@python run_tests.py --html-coverage
	@echo "ğŸ“‹ HTMLæŠ¥å‘Šå·²ç”Ÿæˆ: htmlcov/index.html"

# å®‰è£…æµ‹è¯•ä¾èµ–
install-test-deps:
	@echo "ğŸ“¦ å®‰è£…æµ‹è¯•ä¾èµ–..."
	@python run_tests.py --install-deps

# æ¸…ç†æµ‹è¯•æ–‡ä»¶
clean-test:
	@echo "ğŸ§¹ æ¸…ç†æµ‹è¯•æ–‡ä»¶..."
	@if exist htmlcov rmdir /s /q htmlcov
	@if exist .coverage del .coverage
	@if exist .pytest_cache rmdir /s /q .pytest_cache
	@for /d /r . %%d in (__pycache__) do @if exist "%%d" rmdir /s /q "%%d"
	@echo "âœ… æµ‹è¯•æ–‡ä»¶æ¸…ç†å®Œæˆ"

# æ˜¾ç¤ºæµ‹è¯•å¸®åŠ©
test-help:
	@echo "ğŸ“‹ å¯ç”¨çš„æµ‹è¯•å‘½ä»¤:"
	@echo "  make test              - è¿è¡Œæ‰€æœ‰æµ‹è¯•"
	@echo "  make test-unit         - è¿è¡Œå•å…ƒæµ‹è¯•"
	@echo "  make test-integration  - è¿è¡Œé›†æˆæµ‹è¯•"
	@echo "  make test-functional   - è¿è¡ŒåŠŸèƒ½æµ‹è¯•"
	@echo "  make test-e2e          - è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•"
	@echo "  make test-fast         - è¿è¡Œå¿«é€Ÿæµ‹è¯•ï¼ˆè·³è¿‡æ…¢é€Ÿï¼‰"
	@echo "  make test-browser      - è¿è¡Œæµè§ˆå™¨ç›¸å…³æµ‹è¯•"
	@echo "  make test-coverage     - ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š"
	@echo "  make test-html         - ç”ŸæˆHTMLè¦†ç›–ç‡æŠ¥å‘Š"
	@echo "  make install-test-deps - å®‰è£…æµ‹è¯•ä¾èµ–"
	@echo "  make clean-test        - æ¸…ç†æµ‹è¯•æ–‡ä»¶"
	@echo "  make test-help         - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯"

# æŒç»­é›†æˆæµ‹è¯•
test-ci:
	@echo "ğŸš€ è¿è¡ŒCIæµ‹è¯•æµç¨‹..."
	@python run_tests.py --type all --coverage --verbose

# å¼€å‘è€…æµ‹è¯•ï¼ˆå¿«é€Ÿåé¦ˆï¼‰
test-dev:
	@echo "ğŸ‘¨â€ğŸ’» è¿è¡Œå¼€å‘è€…æµ‹è¯•..."
	@python run_tests.py --type unit --verbose